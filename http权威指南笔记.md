*先挖个坑*
*本笔记基于《http权威指南》2012*

# 第一部分

## 第一章 http概述
- http使用的是可靠的数据传输协议，开发人员只需要注重于应用程序特有细节的编写

- http仔细地给每种要通过web传输的对象都打上了名为MIME类型的数据格式标签,web服务器会为所有http对象数据附加一个MIME类型
MIME类型是一种文本标记
    > html格式的文本由 text/html类型标记<br>
    > ascII文本由 text/plain类型标记
    > jpeg image/jpeg <br>
    > gif image/gif <br>
    > ......

    ### URI
        Uniform Resource Identifier 统一资源标识符
        URI分为url和urn,几乎所有uri都是url
        url 第一部分 http 被称为方案
            第二部分 www.xxxx.com 给出了服务器地址
            第三部分 /xxxx 指定了web服务器的某个资源

- 事务 <br>
    一个http事务由一条客户端往服务端的请求命令和从服务器发回客户端的响应结果组成 <br>
    完成一项任务时通常会发布多个http事务。web浏览器会发布一系列HTTP事务来获取并显示一个包含了丰富图片的web页面
    ### http方法（发往服务端）
        get 
        put
        delete
        post
        head
    ### 状态码

    ### 报文
        请求报文
        GET /xxx HTTP/1.0
        Accept: text/*
        Accept-Language: en,fr

        响应报文
        HTTP/1.0 200 OK //起始行
        Content-type: text/plain //首部
        Content-length: 19
            //空行
        Hi! I'm your daddy! //主体

- 连接 <br>
    http是应用层协议，把联网的细节都交给了tcp/ip协议 <br>
    tcp提供了
    > 无差错的数据传输 <br>
    > 按序输出 <br>
    > 未分段的数据流 <br>
    在http客户端发送报文之前，需要用网际协议(IP)地址和端口号在客户端和服务端之间建立一条tcp/ip连接
    
- web的结构组件
    - 代理 <br>
        位于客户端和服务器之间，接受所有客户端的http请求，将这些请求转发给服务器
    - 缓存 <br>
        特殊的http代理服务器，保存常用文档本地副本以提高性能的代理缓存
    - 网关 gateway <br>
        特殊的服务器
    - 隧道
        建立起来后，会在两条连接之间对原始数据进行盲转发的http应用程序。我不理解
    - Agent代理
        代表用户发起http请求的客户端程序。

## 第二章 URL与资源
- URL的语法 
    - 方案 <br>
        由第一个字母号开始，由第一个“：”符号将其与URL的其余部分分隔开。大小写无关
    - 主机与端口 <br>
        由主机名或者IP地址来表示主机名 <br>
        www.xxxxxxxx.com:80 <br>
        xxx.xx.xx.xxx:80
    - 用户名和密码 <br>
        如果有，在主机名前面，用户名和密码用“：”分隔 <br>
        anonymous:password
    - 路径 <br>
        说明了资源位于服务器的什么地方<br>
        如/xxx.html
    - 参数 <br>
        向应用程序提供它们所需的输入参数，以便正确地与服务端进行交互<br>
        由字符“;”将其与URL的其余部分分割开来。<br>
        如 ftp://xxxx.xx.xx/xxx;type=d <br>
        或者两段 ftp://xxx.xxx/xxx;sale=false/xxx.html;type=d
    - 查询字符串
        “?"右边的部分被称为查询（query）组件。<br>
        常规格式为 http://xxx.xx/xxx?item=111&color=red
    - 片段
        URL可以指向HTML文档中一个特定的图片或小节 <br>
        片段在URL的右手边，最前面有一个字符“#” <br>
        如 http://xxx.xx/xxx#item <br>
        片段仅由浏览器使用
- URL快捷方式
    - 相对URL <br>
        相对URL都是相对基础URL进行解析的
    - 自动扩展URL<br>
        主机名扩展 <br>
        历史扩展

## 第三章 HTTP报文
- 报文流 <br>
    http报文的三个部分
    > 起始行和首部就是由行分隔的ASCII文本。每行都以一个由两个字符组成的行种植序列作为结束，其中包括一个回车符（ASCII码13）和一个换行符（ASCII码10）。<br>
    > 所有的HTTP报文都可以分为请求报文和响应报文。<br>
    >
    > 请求报文的格式
    > ```
    > <method> <request-URL> <version>
    > <headers>
    > 
    > <entity-body>
    > ```
    > 响应报文格式
    > ```
    > <method> <status> <reson-phrase>
    > <headers>
    >
    > <entity-body> 
    > ```
- 方法
    - GET <br>
        通常用于请求服务器发送某个资源，无主体
    - HEAD <br>
        和GET类似，但服务器在响应中只返回首部，不返回实体。<br>
        HEAD可以
        ```
        1.在不获取资源的情况下了解资源的情况
        2.通过查看响应中得状态码，看看某个对象是否存在
        3.通过查看首部，测试资源是否被修改了
        ```
    - PUT <br>
        与GET从服务器读取文档相反，PUT方法会向服务器写入文档。<br>
        PUT方法的语义就是让服务器用请求的主体部分来创建一个由所请求的URL命名的新文档。<br>
        有主体
    - POST
        用于向服务器输入数据的。通常用来支持HTML的表单。
    - TRACE 
        会在目的服务器发起一个“环回”诊断
    - OPTIONS
        请求web服务器告知其支持的各种功能。可以询问服务器通常支持哪些方法，或者对某些特殊资源支持哪些方法。
    - DELETE
        请服务器删除请求URL所指定的资源
- 首部 <br>
    首部和方法配合工作，共同决定了客户端和服务端能做什么事情
    - 通用首部 <br>
        提供了与报文相关的最基本信息
        ```
        Connection
        Date
        MIME-Version
        Trailer
        Trailer-Encoding
        Update
        Via
        ```
    - 请求首部 <br>
        请求首部是只在请求报文中有意义的首部。服务器可以根据请求首部给出的客户端信息，试着为客户端提供更好的响应。
        ```
        Client-IP 提供了运行客户端的机器的IP地址
        From 提供了客户端用户的E-mail地址
        HOST 给出了接收请求的服务器的主机名和端口号
        Accecpt首部、条件请求首部、安全请求首部、代理请求首部搞不明白
        ```
    - 响应首部 <br>
        响应报文有自己的首部集。有助于客户端处理响应，并在将来发起更好的请求
        ```
        协商首部、安全响应首部 
        ```
    - 实体首部<br>
        实体首部提供了有关实体及其内容的大量信息，可以告知报文的接收者它在对什么进行处理。
        ```
        内容首部
            提供了与实体内容有关的特定信息，说明了其类型、尺寸以及处理它所需的其他有用信息。
        Content-Base
        Content-Encoding
        Content-Language
        Content-Length

        实体缓存首部看不懂
        ```
## 第四章 连接管理
- TCP连接 <br>
    TCP为HTTP提供了一条可靠的比特传输管道。从TCP连接一端填入的字节会从另一端以原有的顺序、正确地传送出来
    ```
    1. 浏览器解析出主机名
    2. 浏览器查询这个主机名的IP地址（DNS）
    3. 浏览器获得端口号（80）
    4. 浏览器发起到202.43.78.3端口80的连接
    5. 浏览器向服务器发送一条httpget报文
    6. 浏览器从服务器读取HTTP响应报文
    7. 浏览器关闭连接
    ```
    TCP的数据是通过名为IP分组（或IP数据报）的小数据来发送的。HTTP就是“HTTP over TCP over IP”这个“协议栈”中的最顶层。其安全版本HTTPS就是在HTTP和TCP之间插入了一个（称为TLS或SSL的）密码加密层 <br>
    在任意时刻计算机都可以有几条TCP连接处于打开状态。TCP是通过端口号来保持所有这些连接的正确运行的。
    > TCP是通过4个值来识别的：
    > <源IP地址、源端口号、目的IP地址、目的端口号>

    - 套接字socket <br>
    socket API允许用户创建TCP的端点数据结构，将这些端点与远程服务器的TCP端点进行连接，并对数据流进行读写。TCP API隐藏了所有底层网络协议的握手细节，以及TCP数据流与IP分组之间的分段和重装细节。
- 对TCP性能的考虑
    与建立TCP连接，以及传输请求和响应报文的时间相比，事务处理时间可能是很短的。除非客户端或服务器超载，或正在处理复杂的动态资源，**否则HTTP时延就是由TCP网络时延构成的**。
    HTTP事务的时延由以下几种主要原因：
    > 1. 客户端首先需要根据URI确定web服务器的IP地址和端口号。如果最近没有对URI中的主机名进行访问，通过DNS解析系统将URI中的主机名转换成一个IP地址可能要花费数十秒的时间
    > 2. 客户端向服务端发送一条TCP连接请求，并等待服务器回送一个请求接受应答。每条TCP连接都会有连接建立时延，通常只有一两秒钟，但有数百个HTTP事务的话，会快速地迭加上去。
    > 3. 建立连接后，客户端就会通过新建立的TCP管道来发送HTTP请求。数据到达时，web服务器会从TCP连接中读取请求报文，并对请求进行处理。英特网传输请求,服务器处理请求都需要时间。
    > 4. web服务器回送HTTP请求响应，需要花费时间。
    - 性能聚焦区域 <br>
        高性能的HTTP软件，需要理解以下常见的TCP相关时延：
        1. TCP连接建立握手
        2. TCP慢启动拥塞堵塞
        3. 数据聚集的Nagle算法
        4. 用于捎带确认的TCP延迟确认算法
        5. TIME_WAIT时延和端口耗尽
    - 三次握手
    ```
    1. 客户端发送一个小的TCP分组，分组中设置了一个特殊的SYN标记
    2. 如果服务器接受了连接，就会对一些连接参数进行计算，并向客户端回送一个TCP分组，这个分组中的SYN和ACK标记都被置位，说明连接请求已经被接受
    3. 客户端回一条确认信息，通知连接已经成功建立
    ```

    - 延迟确认
    - TCP慢启动 <br>
        TCP连接回随着时间进行自我调节，起初会限制连接的最大速度，如果数据成功传输，会随着时间的推移提高传输的速度。
    - Nagle算法与TCP_NODELAY
    - TIME_WAIT积累与端口耗尽
- HTTP连接的处理
    - 串行事务处理时延
- 并行连接 <br>
    带宽限制的话性能提升就小，打开大量的连接会消耗很多内存资源，造成服务器性能的下降
- 持久连接
    